<?xml version="1.0" encoding="utf-8"?>
<!--
Unattended Windows 11 installation configuration.
Version: 2.0.0
Author: Armoghan-ul-Mohmin
Purpose:
- Automate a repeatable, zero‑touch Windows 11 deployment.

Contents:
- Local user account creation and initial account settings.
- OOBE (Out‑Of‑Box Experience) customization and privacy/telemetry defaults.
- First‑login provisioning scripts for post‑install cleanup and package removal (debloat).
- Registry changes and UI customizations (taskbar, Explorer, etc.).
- Performance and security optimizations.
- Removal or disablement of unwanted services and optional Windows features.

Notes:
- Validate all changes in a test environment before production use.
- Maintain backups of original configuration and document environment‑specific adjustments.
- Registry edits and component removals may affect system behavior and updates; proceed with caution.
-->

<unattend xmlns="urn:schemas-microsoft-com:unattend" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State">

    <settings pass="windowsPE">
        <component name="Microsoft-Windows-Setup">
			<UserData>
				<ProductKey>VK7JG-NPHTM-C97JM-9MPGT-3V66T
					<WillShowUI>OnError</WillShowUI>
				</ProductKey>
				<AcceptEula>true</AcceptEula>
			</UserData>
			<UseConfigurationSet>false</UseConfigurationSet>
		</component>
    </settings>

    <settings pass="offlineServicing"></settings>
    <settings pass="generalize"></settings>

    <settings pass="specialize">
        <component name="Microsoft-Windows-Deployment" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
			<RunSynchronous>
				<!-- Enable Long Paths -->
				<SynchronousCommand wcm:action="add">
					<Order>1</Order>
					<Path>
						reg.exe add "HKLM\SYSTEM\CurrentControlSet\Control\FileSystem" /v LongPathsEnabled /t REG_DWORD /d 1 /f
					</Path>
					<Description>Enable Long Paths</Description>
				</SynchronousCommand>
				<!-- Set password to never Expire -->
				<SynchronousCommand wcm:action="add">
					<Order>2</Order>
					<Path>
						net.exe account /maxpwage:unlimited
					</Path>
					<Description>Set password to never expire</Description>
				</SynchronousCommand>
				<!-- Disable News and Interests -->
				<SynchronousCommand wcm:action="add">
					<Order>3</Order>
					<Path>
						reg.exe add "HKLM\SOFTWARE\Policies\Microsoft\Dsh" /v AllowNewsAndInterests /t REG_DWORD /d 0 /f
					</Path>
					<Description>Disable News and Interests</Description>
				</SynchronousCommand>
				<!-- Disable Teams Chat auto-install -->
				<SynchronousCommand wcm:action="add">
					<Order>4</Order>
					<Path>
						reg.exe add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Communications" /v ConfigureChatAutoInstall /t REG_DWORD /d 0 /f
					</Path>
					<Description>Disable Teams Chat auto-install</Description>
				</SynchronousCommand>
				<!-- Remove Cortana -->
				<SynchronousCommand wcm:action="add">
					<Order>5</Order>
					<Path>
						reg.exe add "HKLM\SOFTWARE\Policies\Microsoft\Windows\Explorer" /v "NoCortana" /t REG_DWORD /d 1 /f
					</Path>
					<Description>Remove Cortana</Description>
				</SynchronousCommand>
				<!-- Disable Cortana (modern policy) -->
				<SynchronousCommand wcm:action="add">
					<Order>6</Order>
					<Path>reg.exe add "HKLM\SOFTWARE\Policies\Microsoft\Windows\Windows Search" /v AllowCortana /t REG_DWORD /d 0 /f</Path>
					<Description>Disable Cortana</Description>
				</SynchronousCommand>
				<!-- Disable Telemetry -->
				<SynchronousCommand wcm:action="add">
					<Order>7</Order>
					<Path>
						reg.exe add "HKLM\SOFTWARE\Policies\Microsoft\Windows\DataCollection" /v AllowTelemetry /t REG_DWORD /d 0 /f
					</Path>
					<Description>Disable Telemetry</Description>
				</SynchronousCommand>
				<!-- Disable Telemetry -->
				<SynchronousCommand wcm:action="add">
					<Order>8</Order>
					<Path>
						reg.exe add "HKLM\SOFTWARE\Policies\Microsoft\Windows\DataCollection" /v AllowTelemetry /t REG_DWORD /d 0 /f
					</Path>
					<Description>Disable Telemetry</Description>
				</SynchronousCommand>
				<!-- Disable Customer Experience Improvement Program -->
				<SynchronousCommand wcm:action="add">
					<Order>9</Order>
					<Path>
						reg.exe add "HKLM\SOFTWARE\Policies\Microsoft\SQMClient\Windows" /v CEIPEnable /t REG_DWORD /d 0 /f
					</Path>
					<Description>Disable Customer Experience Improvement Program</Description>
				</SynchronousCommand>
			</RunSynchronous>
		</component>
    </settings>

    <settings pass="auditSystem"></settings>
    <settings pass="auditUser"></settings>

    <settings pass="oobeSystem">
        <component name="Microsoft-Windows-Shell-Setup" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS">
			<UserAccounts>
				<LocalAccounts>
					<LocalAccount wcm:action="add">
						<Name>DummyUser</Name>
						<DisplayName>DummyComputer</DisplayName>
						<Group>UserSelection</Group>
						<Password>
							<Value>DummyPassword123!</Value>
							<PlainText>true</PlainText>
						</Password>
					</LocalAccount>
				</LocalAccounts>
			</UserAccounts>
			<AutoLogon>
				<Enabled>true</Enabled>
				<Username>DummyUser</Username>
				<Password>
					<Value>DummyPassword123!</Value>
					<PlainText>true</PlainText>
				</Password>
				<LogonCount>1</LogonCount>
			</AutoLogon>
			<OOBE>
				<HideEULAPage>true</HideEULAPage>
				<ProtectYourPC>3</ProtectYourPC>
				<HideWirelessSetupInOOBE>true</HideWirelessSetupInOOBE>
				<HideOnlineAccountScreens>true</HideOnlineAccountScreens>
			</OOBE>
			<FirstLogonCommands>
				<SynchronousCommand wcm:action="add">
					<Order>1</Order>
					<CommandLine>cmd.exe /c powershell.exe -NoProfile -ExecutionPolicy Bypass -Verb RunAs -Command "Invoke-RestMethod -Uri "https://raw.githubusercontent.com/Get-Winfig/winfig-setup/main/Scripts/RemovePackages.ps1" | Invoke-Expression'; pause"</CommandLine>
					<Description>Remove Unwanted/Bloatware Packages</Description>
				</SynchronousCommand>
				<SynchronousCommand wcm:action="add">
					<Order>2</Order>
					<CommandLine>cmd.exe /c powershell.exe -NoProfile -ExecutionPolicy Bypass -Verb RunAs -Command "Invoke-RestMethod -Uri "https://raw.githubusercontent.com/Get-Winfig/winfig-setup/main/Scripts/RemoveCapabilities.ps1" | Invoke-Expression'; pause"</CommandLine>
					<Description>Remove Unwanted Windows Capabilities</Description>
				</SynchronousCommand>
			</FirstLogonCommands>
		</component>
    </settings>
</unattend>
